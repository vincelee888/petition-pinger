<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Petition Pinger</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.4/d3.min.js" integrity="sha256-V28Aoqm/QLxBnkLyoarf0+wZtgxDAu7mJ9KcBYvTBnI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.0.1/Rx.min.js" integrity="sha256-TeWVfZ29ZE2tO8al/1wPR2TAOWZ1GRXbZ90H5p/dNMY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js" integrity="sha256-8E6QUcFg1KTnpEU8TFGhpTGHw5fJqB9vCms3OhAYLqw=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js" integrity="sha256-1O3BtOwnPyyRzOszK6P+gqaRoXHV6JXj8HkjZmPYhCI=" crossorigin="anonymous"></script>

  <style>
    path.constituency {
      transition: fill 3s ease;
    }
    #main {
      display: -ms-flex;
      display: -webkit-flex;
      display: flex;
      height:600px;
    }
    #outlet {
      min-width: 400px;
      height: 600px;
      width: 32%;
    }
    #outlet svg {
      margin:auto;
      display:block;
    }
    #votes {
      min-width:200px;
      width:67%;
      height:600px;
    }
    table {
      width:100%;
      border-collapse: collapse;
    }
    td, th {
      border: 1px solid #999;
      padding: 5px;
      text-align: left;
    }
    .new-entry {
      background-color: green;
    }
    .moving-up:after {
      content: ' \2191 ';
      color:green;
    }
    .moving-down:after {
      content: ' \2193 ';
      color:red;
    }
    .steady:after {
      content: ' \2194 ';
    }
    .highlight {
      transition: none !important;
      fill:green !important;
    }
    .constituency-name {
      cursor: pointer;
    }
    #flash {
      color:red;
      font-size: xx-large;
      font-weight: bold;
    }
    #petition {
      width: 350px;
    }
  </style>
</head>
<body>

<h1>Petition Pinger</h1>
<p>
I was amazed at how quickly <a href="https://petition.parliament.uk/petitions/171928" target="_blank">this petition</a> was being signed and noticed that the data is <a href="https://petition.parliament.uk/petitions/171928.json" target="_blank">published as JSON</a> so decided to see where the votes were coming from. <a href="https://github.com/pauldambra/petition-pinger">(fork me on github)</a>
<p>
  <p>
    <div id="now-tracking-outlet"></div>

    <div>
      <label for="petition">Petition URL:</label>
      <input id="petition" value="https://petition.parliament.uk/petitions/241584.json" list="popular-petitions"/>
      <datalist id="popular-petitions"></datalist>
    </div>
  </p>
  <div id="flash"></div>
<div id="main">

  <div id="outlet">
    <svg></svg>
  </div>
  <div id="votes">
  </div>
</div>

<script id="now-tracking-template" type="text/x-handlebars-template">
  <p>
    Now tracking <a href="{{url}}">{{name}}</a> with {{signatureCount}} signatures
  <p>
</script>

<script id="leaderboard-template" type="text/x-handlebars-template">
  <h1>
    Top 20 Consituencies by Votes
  </h1>
  <table>
      <thead>
          <th>Constituency</th>
          <th>Votes</th>
      </thead>
      <tbody>
          {{#leaders}}
          <tr {{newEntry}}>
              <td class="constituency-name"
                  data>
                  {{name}}
              </td>
              <td>
                <span {{movement}}
                    data-position="{{position}}"
                    data-last-position="{{lastPosition}}">
                  {{signature_count}}
                </span>
              </td>
          </tr>
          {{/leaders}}
      </tbody>
  </table>
</script>

  <script src="uk.electionmap.d3.js"></script>
  <script src="hoverer.js"></script>
  <script src="pinger.js"></script>

  <script>
    var svg = d3.select('#outlet svg')
                .attr('height', 500)
                .attr('width', 400);
    window.map = UK.ElectionMap();
    window.map = window.map.edgeLength(6);
    window.map = window.map.constituencyIdentifier(window.constituencies.makeNameSafe);
    window.map(svg);
  </script>
</body>
</html>
